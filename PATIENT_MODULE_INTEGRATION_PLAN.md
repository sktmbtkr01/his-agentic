# Patient Module Integration Plan

Based on the `PATIENT_MODULE_CHANGES_PRD.md` and the current state of the repository, here is the roadmap to merge the new Patient Module features into your `his-agentic` project.

## ‚ö†Ô∏è Critical Prerequisite: Source Code

**Current Status**: The file directory currently does **not** contain the `patient-portal` folder or the new backend files (`models/Signal.js`, `controllers/patient/`, etc.) described in the PRD. 

**Action Needed**: We need to bring the code from your friend's repository into this workspace. 

## üó∫Ô∏è Integration Roadmap

### Phase 1: Backend Integration (Node.js)
The backend needs to support the new Patient usage patterns (separate auth, health tracking).

1.  **Database Updates**:
    *   **New Models**: Create `Signal.js`, `HealthScore.js`, `CareNudge.js`, `PatientDocument.js`.
    *   **Schema Updates**: Update `Patient.js` to include the `referral` and `idDocument` fields.
2.  **API Expansion**:
    *   **New Routes**: Create `routes/patient/` directory and add all 9 route files (Auth, Score, Signals, etc.).
    *   **New Controllers**: Create `controllers/patient/` directory with corresponding logic.
    *   **Server Entry Point**: Update `server.js` to mount the new `/api/v1/patient` base route for the portal.
3.  **Service Logic**:
    *   Implement the Health Score Engine logic (`services/healthScore.service.js`).
    *   Implement the Timeline Aggregator (`services/timeline.service.js`).

### Phase 2: Microservices Update (Python/Docker)
Your friend fixed the Voice Agent and validated the OCR. We need to ensure these fixes are applied.

1.  **Voice Agent**: Update the code in `voice-agent/` with the fixes she made (likely improving the WebSocket handling or prompt engineering).
2.  **OCR Service**: Ensure `his-id-ocr/` is using the correct Donut model and has the new `scan-id` logic if any changes were made there.

### Phase 3: Patient Portal Frontend (React)
This is a brand new application, separate from your main Hospital Dashboard.

1.  **Initialization**: Create a new folder `patient-portal` at the root (sibling to `hospital-his-frontend`).
    *   *Decision Point*: You can keep it in this mono-repo structure.
2.  **Configuration**: Setup Vite, Tailwind, and the environment variables (`VITE_API_URL`, etc.).
3.  **Implementation**: Add all the pages and components defined in the PRD (Login, Dashboard, LifeLens, etc.).

### Phase 4: Main Frontend Updates (React)
The staff needs to see the new data generated by patients.

1.  **Patient View**: Update the existing `hospital-his-frontend` Patient Details page to show:
    *   Uploaded Documents (from the new OCR flow).
    *   Referral Statistics.
    *   Possibly a view of their Health Score.

### Phase 5: Deployment Strategy
We will need to update the deployment workflow to handle the second frontend.

1.  **Backend**: Redeploy to HF Spaces to apply the new API routes.
2.  **Patient Portal**: Deploy as a **separate Vercel Project** (e.g., `his-patient-portal.vercel.app`).
    *   It needs its own `VITE_API_URL` pointing to the same backend.
3.  **Workflow Update**: Update `deploy-agentic-his.md` to include instructions for the Patient Portal.

## ‚ùì Immediate Next Steps for You

To proceed, please clarify how we should access the new code:
1.  **Do you have the files locally?** (e.g., a zip file or a folder you can drag in?)
2.  **Is there a git branch?** (We can try to fetch from a remote if you provide the URL).
3.  **Should I generate the code?** (I can write the backend files and scaffold the frontend based on the PRD, but using her actual code is better if available).
